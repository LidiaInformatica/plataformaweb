{% load humanize %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Registrar Cuotas</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f0f2f5;
        }
        .section-title {
            background-color: #003366;
            color: white;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        .form-section {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .mensaje {
            text-align: center;
            font-weight: bold;
            margin-top: 20px;
        }
    </style>
</head>
<body>

<!-- Encabezado institucional -->
<header class="bg-primary text-white p-3">
    <div class="container d-flex justify-content-between align-items-center flex-wrap">
        <div>
            <h2 class="mb-0">Sistema de Gestión de Cuotas</h2>
            <p class="mb-0">Colegio Adventista Talcahuano Centro</p>
        </div>
        <div class="text-end">
            <span class="me-3">🔒 Sesión activa como Directiva</span>
            <a href="#" class="text-warning text-decoration-none me-3">⚙️ Configuración</a>
        </div>
    </div>
</header>

<!-- Navegación -->
<nav class="bg-light border-bottom py-2 mb-4">
    <div class="container d-flex gap-4 fw-bold">
        <a href="{% url 'cuotas:panel_cuotas' %}" class="text-decoration-none text-dark">🏠 Panel Principal</a>
        <a href="{% url 'cuotas:registrar_pago' %}" class="text-decoration-none text-primary border-bottom border-primary">📝 Registrar Cuotas</a>
        <a href="{% url 'cuotas:estado_pagos' %}" class="text-decoration-none text-dark">📊 Estado de Pagos</a>
    </div>
</nav>

<!-- Formulario -->
<div class="container">
    <h2 class="section-title">Formulario de Registro de Cuotas</h2>

    <form method="post" onsubmit="limpiarMontoAntesDeEnviar()">
        {% csrf_token %}

        <!-- Datos del estudiante -->
        <div class="form-section">
            <h5 class="mb-3">📘 Datos del estudiante</h5>
            <label for="id_estudiante" class="form-label">🔍 Seleccione estudiante</label>
            {{ form.estudiante }}
        </div>

        <!-- Información del pago -->
        <div class="form-section">
            <h5 class="mb-3">💰 Información del pago</h5>

            <label for="id_actividad" class="form-label">ℹ️ Actividad escolar</label>
            {{ form.actividad }}

            <label for="id_monto_pagado" class="form-label mt-3">💵 Monto Pagado</label>
            {{ form.monto_pagado }}

            {% if saldo_pendiente %}
                <label class="form-label mt-3">🔴 Monto Pendiente</label>
                <p class="text-danger"><strong>● ${{ saldo_pendiente|floatformat:0|intcomma }}</strong></p>
            {% endif %}

            <label for="id_estado_pago" class="form-label mt-3">💳 Estado del Pago</label>
            {{ form.estado_pago }}

            <label for="id_fecha_pago" class="form-label mt-3">📅 Fecha de Pago</label>
            {{ form.fecha_pago }}

            <label for="id_observacion" class="form-label mt-3">📝 Observación</label>
            {{ form.observacion }}
        </div>

        <!-- Botones -->
        <div class="text-center mt-4">
            <button type="submit" class="btn btn-success btn-lg px-5">✔ Registrar Pago</button>
            <button type="reset" class="btn btn-outline-secondary btn-lg ms-2">💬 Limpiar Formulario</button>
        </div>
    </form>

    {% if form.errors %}
        <div class="mensaje text-danger">✖ ¡Complete todos los campos obligatorios!</div>
    {% elif mensaje_exito %}
        <div class="mensaje text-success">✔ ¡Pago registrado correctamente!</div>
    {% endif %}
</div>

<!-- Scripts -->
<script>
function formatearMonto(input) {
    let valor = input.value.replace(/\./g, '').replace(',', '.');
    let numero = parseFloat(valor);
    if (!isNaN(numero)) {
        let entero = Math.round(numero);
        input.value = entero.toLocaleString('es-CL');
    }
}

function limpiarMontoAntesDeEnviar() {
    let input = document.getElementById("id_monto_pagado");
    let valor = input.value.replace(/\./g, '').replace(',', '.');
    let numero = parseFloat(valor);
    if (!isNaN(numero)) {
        input.value = Math.round(numero);
    }
}
</script>

</body>
</html>